# Data Model: FastAPI RAG Integration

**Feature**: FastAPI RAG Integration
**Created**: 2025-12-29

## Request Models

### QueryRequest
- **query**: string (required) - The user's question or query text
  - Validation: Minimum length of 3 characters
  - Description: The text content of the user's query to be processed by the RAG agent
- **conversation_id**: string (optional) - Unique identifier for conversation continuity
  - Validation: UUID format if provided
  - Description: Maintains context across multiple queries in a conversation
- **debug**: boolean (optional) - Flag to enable debug mode
  - Default: false
  - Description: Enables debug output with retrieved chunks and similarity scores

### HealthCheckRequest
- No fields required
- Simple request to verify API server health

## Response Models

### QueryResponse
- **response**: string (required) - The RAG agent's response to the query
  - Description: The answer generated by the RAG agent based on textbook content
- **conversation_id**: string (optional) - Conversation identifier for continuity
  - Description: The ID of the conversation context (may be newly created)
- **sources**: array of strings (optional) - Source citations for the response
  - Description: List of source URLs or document references used in the response
- **debug_info**: object (optional) - Debug information when debug mode is enabled
  - Description: Contains details about retrieved chunks, similarity scores, etc.

### HealthCheckResponse
- **status**: string (required) - Health status of the service
  - Values: "healthy", "degraded", "unhealthy"
  - Description: Overall health status of the API service
- **timestamp**: string (required) - ISO 8601 timestamp of the health check
  - Description: When the health check was performed
- **dependencies**: object (optional) - Status of dependent services
  - Description: Health status of agent, Qdrant, and other dependencies

### ErrorResponse
- **error**: string (required) - Error message
  - Description: Human-readable error message
- **error_code**: string (optional) - Machine-readable error code
  - Description: Standardized error code for client handling
- **details**: object (optional) - Additional error details
  - Description: Extended error information for debugging

## Internal Models

### AgentResponse
- **content**: string (required) - The agent's response content
  - Description: The main content of the agent's response
- **metadata**: object (optional) - Additional response metadata
  - Description: Contains source information, confidence scores, etc.
- **conversation_id**: string (required) - Associated conversation ID
  - Description: The conversation context for this response

## Validation Rules

### QueryRequest Validation
- Query text must be at least 3 characters long
- Conversation ID must be a valid UUID format if provided
- Maximum query length of 1000 characters
- Query must contain at least one non-whitespace character

### Response Validation
- Response must not be empty
- Sources array items must be valid URLs or document references
- Conversation ID in response must match the request if provided

## State Transitions

### Conversation State
- **New**: When no conversation_id is provided, a new conversation is started
- **Active**: When a conversation_id is provided and exists, conversation continues
- **Extended**: When a response is generated, the conversation context is updated

## Relationships

### QueryRequest to AgentResponse
- One-to-one relationship during processing
- QueryRequest is transformed into AgentResponse through RAG processing

### QueryResponse to Conversation Context
- QueryResponse may create or update conversation context
- Maintains continuity for follow-up queries